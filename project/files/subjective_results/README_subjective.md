# 主観評価データ分析結果 - 説明書

## 概要

このディレクトリには、subjective.csvデータに対する統計解析結果が含まれています。
7段階のリッカート尺度を用いた主観評価データを、被験者内一要因計画で分析しました。

### データ構造

- **被験者数**: 6名
- **距離条件**: 5水準（0cm, 15cm, 30cm, 45cm, 60cm）
- **評価項目**: 6項目（7段階リッカート尺度: 1-7）
  1. **吹き出しの読みやすさ** (Readability) - ポジティブ項目
  2. **目のしょぼつき** (Eye strain) - ネガティブ項目
  3. **目の疲れ** (Eye fatigue) - ネガティブ項目
  4. **目の痛み** (Eye pain) - ネガティブ項目
  5. **目の乾き** (Eye dryness) - ネガティブ項目
  6. **ものがぼやけて見える** (Blurred vision) - ネガティブ項目

### 評価項目の方向性

**重要な注意点:**
- **読みやすさ**: 数値が**高いほど良い**（7=非常に読みやすい、1=全く読めない）
- **その他5項目**: 数値が**低いほど良い**（1=全く症状なし、7=非常に症状あり）

---

## ファイル構造

```
subjective_results/
├── README_subjective.md              # このファイル
├── subjective_results.xlsx           # 統計結果（Excel）
└── visualizations/                   # 可視化
    ├── boxplots_all_items.png
    ├── heatmap_median_ratings.png
    ├── stacked_bar_distribution.png
    └── radar_profile.png
```

---

## リッカート尺度データとは

### 定義

**リッカート尺度**は、態度や意見を測定するための心理測定尺度です。
通常3～7段階（本研究では7段階）で、「全くそう思わない」から「非常にそう思う」のような選択肢を用います。

### 統計的性質

| 項目 | 説明 |
|------|------|
| **尺度の種類** | 順序尺度（間隔尺度として扱う場合もある） |
| **データの分布** | 通常、正規分布に従わない |
| **適切な代表値** | 中央値（メディアン） |
| **適切な検定** | ノンパラメトリック検定 |

### なぜFriedman検定を使用するか

1. **正規性の問題**: リッカート尺度データは正規分布しないことが多い
2. **順序尺度**: 1と2の差が、6と7の差と等しいとは限らない
3. **小標本**: サンプルサイズが小さい（n=6）
4. **反復測定**: 同じ被験者が全条件を経験（被験者内計画）

**Friedman検定**は、反復測定ANOVAのノンパラメトリック版で、これらの問題に対応できます。

---

## subjective_results.xlsx の内容

### シート一覧

1. **Desc_[項目名]** (6シート) - 各評価項目の記述統計
2. **Normality_Tests** - 正規性検定の結果
3. **Friedman_Tests** - Friedman検定の結果（全項目のサマリー）
4. **PostHoc_[項目名]** - 事後検定の結果（有意な項目のみ）

---

## 各シートのカラム説明

### 1. Desc_[項目名]（記述統計）シート

各評価項目×距離条件の記述統計量です。

| カラム名 | 説明 | 重要度 |
|---------|------|--------|
| **distance** | 距離条件 | - |
| **count** | データ点数（各条件6名） | ★ |
| **median** | **中央値**（最重要な代表値） | ★★★ |
| **mean** | 平均値（参考値） | ★ |
| **std** | 標準偏差 | ★ |
| **q1** | 第1四分位数（25%タイル） | ★★ |
| **q3** | 第3四分位数（75%タイル） | ★★ |
| **min** | 最小値 | ★ |
| **max** | 最大値 | ★ |

**解釈のポイント:**
- **median**（中央値）が主要な代表値
- **q1とq3**でデータの広がりを把握
- 平均値は外れ値の影響を受けやすいため参考程度

---

### 2. Normality_Tests（正規性検定）シート

各評価項目×距離条件の正規性を検定した結果です。

| カラム名 | 説明 |
|---------|------|
| **evaluation_item** | 評価項目名 |
| **distance** | 距離条件 |
| **W** | Shapiro-Wilk検定のW統計量（0～1） |
| **p_value** | 有意確率 |
| **normal** | 正規性の判定（Yes/No） |

**解釈:**
- **p_value < 0.05**: 正規分布に従わない → Friedman検定が適切
- **p_value ≥ 0.05**: 正規分布に従う → ANOVAも可能

**本データの結果:**
多くの条件で正規性が満たされないため、Friedman検定を使用しました。

---

### 3. Friedman_Tests（Friedman検定）シート

**最も重要なシート**です。各評価項目で距離条件による効果を検定します。

| カラム名 | 説明 |
|---------|------|
| **evaluation_item** | 評価項目名 |
| **Q** | Friedman検定統計量（カイ二乗分布に従う） |
| **p_value** | 有意確率 |
| **W** | Kendallの一致係数（効果量、0～1） |
| **significance** | 有意性レベル（***, **, *, n.s.） |

#### p値の解釈

- **p < 0.001**: *** (非常に有意)
- **p < 0.01**: ** (非常に有意)
- **p < 0.05**: * (有意)
- **p ≥ 0.05**: n.s. (有意差なし)

#### Kendallの一致係数（W）の解釈

効果量の指標です（0～1の範囲）。

- **W < 0.1**: 効果なし
- **0.1 ≤ W < 0.3**: 小さい効果
- **0.3 ≤ W < 0.5**: 中程度の効果
- **W ≥ 0.5**: 大きい効果

#### 多重比較補正

**重要**: 6つの評価項目を同時に検定しているため、偶然有意になる確率が高まります。

- **Bonferroni補正**: α = 0.05 / 6 = **0.0083**
- 補正後のα以下のp値のみを「真に有意」と判断

---

### 4. PostHoc_[項目名]（事後検定）シート

Friedman検定で有意差が認められた項目についてのみ作成されます。
どの距離条件間に差があるかを特定します。

| カラム名 | 説明 |
|---------|------|
| **A** | 比較する距離条件1 |
| **B** | 比較する距離条件2 |
| **W-val** | Wilcoxon検定のW統計量 |
| **p-unc** | 補正前のp値 |
| **p-corr** | Holm-Bonferroni法で補正後のp値 |
| **CLES** | 共通言語効果量（0～1） |

**解釈:**
- **p-corr < 0.05**: 2つの距離条件間に有意差あり
- **CLES**: 条件Aが条件Bより高い確率
  - CLES = 0.5: 差なし
  - CLES > 0.5: 条件Aの方が高い
  - CLES < 0.5: 条件Bの方が高い

---

## 可視化の見方

### 1. boxplots_all_items.png（箱ひげ図）

**説明:**
6つの評価項目それぞれについて、5つの距離条件ごとの分布を箱ひげ図で表示。

**見方:**
- **箱の中の線**: 中央値
- **箱の上下**: 第1・第3四分位数（データの中央50%の範囲）
- **ひげ**: データの範囲
- **点**: 外れ値

**注目ポイント:**
- **読みやすさ**: 箱が高い位置にあるほど良い
- **その他項目**: 箱が低い位置にあるほど良い
- 箱が重ならない条件間は差がある可能性

---

### 2. heatmap_median_ratings.png（ヒートマップ）

**説明:**
評価項目×距離条件の中央値を色で表現。

**色の意味:**
- **緑色**: 低い値（目の症状では「良い」）
- **黄色**: 中程度
- **赤色**: 高い値（目の症状では「悪い」）

**注意:**
読みやすさは逆で、緑=低い=悪い、赤=高い=良いとなります。

**見方:**
- 縦方向: 同じ評価項目での距離条件の比較
- 横方向: 同じ距離条件での評価項目の比較
- 全体的なパターンを把握

---

### 3. stacked_bar_distribution.png（積み上げ棒グラフ）

**説明:**
各評価項目×距離条件について、1～7の各評価値の割合を積み上げ棒グラフで表示。

**見方:**
- 各バーは100%を表す
- 色の分布でリッカート尺度の回答分布を視覚化
- 左側（緑）: 低い評価
- 右側（赤）: 高い評価

**注目ポイント:**
- 分布が偏っている場合、合意が高い
- 分布が広い場合、個人差が大きい

---

### 4. radar_profile.png（レーダーチャート）

**説明:**
各距離条件について、6つの評価項目の中央値をレーダーチャートで表示。

**見方:**
- 各頂点: 1つの評価項目
- 中心からの距離: 評価値（中心=1、外側=7）
- 異なる色の線: 異なる距離条件

**注目ポイント:**
- **読みやすさ**: 外側ほど良い
- **その他項目**: 中心に近いほど良い
- 条件間で形が大きく異なれば、評価パターンが異なる

---

## 本データの分析結果

### Friedman検定結果サマリー

| 評価項目 | p値 | 有意性 | Bonferroni補正後 |
|---------|-----|--------|-----------------|
| **読みやすさ** | **0.027** | * | 有意でない |
| 目のしょぼつき | 0.723 | n.s. | 有意でない |
| 目の疲れ | 0.247 | n.s. | 有意でない |
| 目の痛み | 0.502 | n.s. | 有意でない |
| 目の乾き | 0.059 | n.s. | 有意でない |
| ぼやけて見える | 0.550 | n.s. | 有意でない |

### 重要な発見

1. **読みやすさ**:
   - 距離条件による有意な効果あり（p = 0.027 < 0.05）
   - ただし、Bonferroni補正後（α = 0.0083）は有意でない
   - 中央値を見ると、0cm(5.5) > 15cm(5.0) > 45cm(4.0) > 30cm(3.5) > 60cm(2.0)
   - **近距離ほど読みやすい傾向**

2. **目の症状**:
   - すべて有意差なし
   - 距離条件による明確な影響は検出されず

3. **目の乾き**:
   - p = 0.059（有意に近い）
   - サンプルサイズを増やせば有意になる可能性

### 考察

**読みやすさの傾向:**
- 距離が遠くなるほど読みにくくなる一貫した傾向
- これは視覚的な物理法則と一致
- 実用上は有意と考えてよい可能性

**目の症状なし:**
- 個人差が大きい（サンプルサイズ不足の可能性）
- または、どの距離でも目への負担は同程度
- 実験時間が短く症状が顕在化しなかった可能性

---

## スクリプトの実行方法

```bash
# 仮想環境の有効化
source project/.tobiienv/bin/activate

# デフォルトのCSVファイルで実行
python project/src/analysis/subjective_analysis.py

# カスタムCSVファイルを指定
python project/src/analysis/subjective_analysis.py path/to/your_subjective.csv
```

**CSVファイルの形式:**
- 4列目: 条件（a, b, c, d, e）
- 5-10列目: 6つの評価項目
- 1行目: ヘッダー
- 2行目以降: データ（各被験者×条件）

---

## 使用した統計パッケージ

- **pandas**: データ処理
- **scipy.stats**: Shapiro-Wilk検定
- **pingouin**: Friedman検定、Wilcoxon検定
- **matplotlib & seaborn**: 可視化
- **numpy**: 数値計算

---

## よくある質問（FAQ）

### Q1: リッカート尺度は平均を使ってはいけないのですか？
**A**:
- 厳密には順序尺度なので中央値が適切
- ただし、7段階なら平均値を使う研究も多い
- 本分析では中央値を主に使用し、平均値は参考値として提示

### Q2: なぜ読みやすさだけ有意だったのですか？
**A**:
- 読みやすさは物理的な視距離に直接関係
- 目の症状は個人差が大きく、実験時間も影響
- 疲労は累積効果があり、短時間では検出しにくい

### Q3: Bonferroni補正後に有意でなくなりましたが？
**A**:
- Bonferroni補正は非常に保守的（厳しい）
- 探索的研究では補正前の結果も参考に
- ただし、結論を述べる際は補正後の結果を優先

### Q4: サンプルサイズ（n=6）が小さすぎませんか？
**A**:
- 被験者内計画なので、データ点は30点（6名×5条件）
- ノンパラメトリック検定は小標本に強い
- ただし、検出力は低いため、差があっても検出できない可能性
- n ≥ 10 が理想的

### Q5: 相関分析はしないのですか？
**A**:
- 評価項目間の相関を見ることも有用
- 例: 「目の疲れ」と「ぼやけ」は相関が高いかもしれない
- 今回は条件効果に焦点を当てたため省略
- 必要に応じて追加分析可能

---

## トラブルシューティング

### エラー: 日本語文字が文字化けする
matplotlibの日本語フォント設定を確認してください。
```python
plt.rcParams['font.sans-serif'] = ['ヒラギノ角ゴ ProN']
```

### 警告: "Sample size is small"
サンプルサイズが小さいため、結果の解釈には注意が必要です。

### エラー: "Column not found"
CSV形式が想定と異なる可能性があります。CSVの列順序を確認してください。

---

## 参考文献

### リッカート尺度の分析
- Carifio, J., & Perla, R. (2008). Resolving the 50-year debate around using and misusing Likert scales. *Medical education*, 42(12), 1150-1152.
- Sullivan, G. M., & Artino Jr, A. R. (2013). Analyzing and interpreting data from Likert-type scales. *Journal of graduate medical education*, 5(4), 541-542.

### ノンパラメトリック検定
- Friedman, M. (1937). The use of ranks to avoid the assumption of normality implicit in the analysis of variance.
- Conover, W. J. (1999). *Practical nonparametric statistics* (Vol. 350). John Wiley & Sons.

### 多重比較
- Holm, S. (1979). A simple sequentially rejective multiple test procedure. *Scandinavian journal of statistics*, 65-70.

---

## 更新履歴

- 2025-10-26: 初版作成

---

## お問い合わせ

分析に関する質問や追加の統計解析が必要な場合は、スクリプト作成者にお問い合わせください。

**生成スクリプト**: `project/src/analysis/subjective_analysis.py`
